import{c as R}from"./chunk-J4FXYLKG.js";import{$a as y,Bb as D,E as h,Na as S,Oa as F,T as m,W as c,X as k,_ as p,a as d,b as v,d as s,ed as f,jd as g,k as b,p as l,q as B,t as u,yc as E,zc as C}from"./chunk-MML5RVMT.js";var A=(()=>{class a{get vertical(){return this._vertical}set vertical(t){this._vertical=g(t)}_vertical=!1;get inset(){return this._inset}set inset(t){this._inset=g(t)}_inset=!1;static \u0275fac=function(r){return new(r||a)};static \u0275cmp=S({type:a,selectors:[["mat-divider"]],hostAttrs:["role","separator",1,"mat-divider"],hostVars:7,hostBindings:function(r,o){r&2&&(y("aria-orientation",o.vertical?"vertical":"horizontal"),D("mat-divider-vertical",o.vertical)("mat-divider-horizontal",!o.vertical)("mat-divider-inset",o.inset))},inputs:{vertical:"vertical",inset:"inset"},decls:0,vars:0,template:function(r,o){},styles:[`.mat-divider{display:block;margin:0;border-top-style:solid;border-top-color:var(--mat-divider-color, var(--mat-sys-outline-variant));border-top-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-vertical{border-top:0;border-right-style:solid;border-right-color:var(--mat-divider-color, var(--mat-sys-outline-variant));border-right-width:var(--mat-divider-width, 1px)}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}
`],encapsulation:2,changeDetection:0})}return a})(),j=(()=>{class a{static \u0275fac=function(r){return new(r||a)};static \u0275mod=F({type:a});static \u0275inj=k({imports:[f,f]})}return a})();var I=class a{STORAGE_KEY="findbook-favorites";DB_NAME="FindBookDB";DB_STORE="favorites";favoritesSubject=new b([]);offlineQueue=[];useIndexedDB=!1;favorites$=this.favoritesSubject.asObservable();constructor(){this.useIndexedDB=typeof window<"u"&&"indexedDB"in window,this.loadFavorites(),window.addEventListener("online",()=>this.syncOfflineQueue())}getFavorites(){return this.favoritesSubject.value}getFavoriteIds(){return new Set(this.favoritesSubject.value.map(e=>e.id))}isFavorite(e){return this.getFavoriteIds().has(e)}addToFavorites(e){let t=this.getFavorites();if(this.isFavorite(e.id))return;let r={id:e.id,title:e.title,authors:e.authors||[],imageUrl:e.imageLinks?.thumbnail?.replace("http:","https:"),addedDate:new Date},o=[r,...t];this.updateFavorites(o),navigator.onLine?this.saveFavoriteToDB(r):this.offlineQueue.push(r)}removeFromFavorites(e){let r=this.getFavorites().filter(o=>o.id!==e);this.updateFavorites(r),navigator.onLine?this.removeFavoriteFromDB(e):this.offlineQueue.push({id:e,title:"",authors:[],addedDate:new Date})}toggleFavorite(e){let t=this.isFavorite(e.id);return t?this.removeFromFavorites(e.id):this.addToFavorites(e),!t}clearAllFavorites(){this.updateFavorites([]),navigator.onLine&&this.clearFavoritesFromDB()}getFavoritesCount(){return this.getFavorites().length}searchFavorites(e){if(!e.trim())return this.getFavorites();let t=e.toLowerCase();return this.getFavorites().filter(r=>r.title.toLowerCase().includes(t)||r.authors.some(o=>o.toLowerCase().includes(t)))}getRecentFavorites(e=5){return this.getFavorites().sort((t,r)=>new Date(r.addedDate).getTime()-new Date(t.addedDate).getTime()).slice(0,e)}exportFavorites(){return JSON.stringify(this.getFavorites(),null,2)}importFavorites(e){try{let t=JSON.parse(e);if(!Array.isArray(t)||!t.every(i=>i&&typeof i.id=="string"&&typeof i.title=="string"&&Array.isArray(i.authors)))return!1;let o=t.map(i=>v(d({},i),{addedDate:new Date(i.addedDate)}));return this.updateFavorites(o),!0}catch(t){return console.error("Failed to import favorites:",t),!1}}updateFavorites(e){this.favoritesSubject.next(e),this.useIndexedDB?this.saveFavoritesToDB(e):this.saveFavoritesToStorage(e)}loadFavoritesFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let r=JSON.parse(e).map(o=>v(d({},o),{addedDate:new Date(o.addedDate)}));this.favoritesSubject.next(r)}}catch(e){console.error("Failed to load favorites from storage:",e),this.favoritesSubject.next([])}}loadFavorites(){this.useIndexedDB?this.loadFavoritesFromDB():this.loadFavoritesFromStorage()}openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.DB_NAME,1);r.onupgradeneeded=o=>{let i=o.target.result;i.objectStoreNames.contains(this.DB_STORE)||i.createObjectStore(this.DB_STORE,{keyPath:"id"})},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}loadFavoritesFromDB(){return s(this,null,function*(){try{let o=(yield this.openDB()).transaction(this.DB_STORE,"readonly").objectStore(this.DB_STORE).getAll();o.onsuccess=()=>{let i=o.result;this.favoritesSubject.next(i)},o.onerror=()=>{console.error("Failed to load favorites from IndexedDB:",o.error),this.favoritesSubject.next([])}}catch(e){console.error("IndexedDB error:",e),this.favoritesSubject.next([])}})}saveFavoritesToDB(e){return s(this,null,function*(){try{let o=(yield this.openDB()).transaction(this.DB_STORE,"readwrite").objectStore(this.DB_STORE);o.clear();for(let i of e)o.put(i)}catch(t){console.error("Failed to save favorites to IndexedDB:",t)}})}saveFavoriteToDB(e){return s(this,null,function*(){try{(yield this.openDB()).transaction(this.DB_STORE,"readwrite").objectStore(this.DB_STORE).put(e)}catch(t){console.error("Failed to save favorite to IndexedDB:",t)}})}removeFavoriteFromDB(e){return s(this,null,function*(){try{(yield this.openDB()).transaction(this.DB_STORE,"readwrite").objectStore(this.DB_STORE).delete(e)}catch(t){console.error("Failed to remove favorite from IndexedDB:",t)}})}clearFavoritesFromDB(){return s(this,null,function*(){try{(yield this.openDB()).transaction(this.DB_STORE,"readwrite").objectStore(this.DB_STORE).clear()}catch(e){console.error("Failed to clear favorites from IndexedDB:",e)}})}syncOfflineQueue(){return s(this,null,function*(){if(this.offlineQueue.length){for(let e of this.offlineQueue)e.title?yield this.saveFavoriteToDB(e):yield this.removeFavoriteFromDB(e.id);this.offlineQueue=[],this.loadFavorites()}})}saveFavoritesToStorage(e){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(t){console.error("Failed to save favorites to storage:",t)}}static \u0275fac=function(t){return new(t||a)};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};var O=class a{constructor(e,t){this.http=e;this.performanceService=t;this.loadPersistentCaches()}SEARCH_CACHE_STORAGE_KEY="findbook-search-cache";BOOK_CACHE_STORAGE_KEY="findbook-book-cache";apiBaseUrl="https://DISABLED-API.com/books/v1";defaultMaxResults=20;enableExternalApiCalls=!1;bookCache=new Map;searchCache=new Map;CACHE_TTL_MS=300*1e3;searchBooks(e){if(this.performanceService.markStart("book-search"),!this.enableExternalApiCalls)return this.performanceService.markEnd("book-search"),l({books:[],totalItems:0,query:e.query,currentPage:1,itemsPerPage:20,hasMoreResults:!1,searchTimestamp:new Date});let t=JSON.stringify(e),r=this.searchCache.get(t);if(r&&Date.now()-r.timestamp<this.CACHE_TTL_MS)return this.performanceService.markEnd("book-search"),l(r.result);r&&(this.searchCache.delete(t),this.savePersistentCaches());let o=this.buildSearchParams(e);return this.http.get(`${this.apiBaseUrl}/volumes`,{params:o}).pipe(m(()=>this.performanceService.markEnd("book-search")),u(i=>{let n=this.transformGoogleBooksResponse(i,e);return this.searchCache.set(t,{result:n,timestamp:Date.now()}),this.savePersistentCaches(),n}),h((i,n)=>(this.performanceService.markEnd("book-search"),i.status===0||i.status===503?n.pipe():this.handleError(i,"Failed to search books"))))}getBookById(e){if(this.performanceService.markStart("book-details"),!this.enableExternalApiCalls){this.performanceService.markEnd("book-details");let r={id:e,title:"Book temporarily unavailable",authors:["Unknown"],description:"External book service is temporarily unavailable. Please try again later.",publishedDate:new Date().getFullYear().toString(),categories:[],pageCount:0,language:"en",averageRating:0,ratingsCount:0,maturityRating:"NOT_MATURE",accessViewStatus:"NONE",webReaderLink:void 0,imageLinks:{thumbnail:"",smallThumbnail:""},industryIdentifiers:[]};return l(r)}let t=this.bookCache.get(e);return t&&Date.now()-t.timestamp<this.CACHE_TTL_MS?(this.performanceService.markEnd("book-details"),l(t.book)):(t&&(this.bookCache.delete(e),this.savePersistentCaches()),this.http.get(`${this.apiBaseUrl}/volumes/${e}`).pipe(m(()=>this.performanceService.markEnd("book-details")),u(r=>{let o=this.transformVolumeItem(r);return this.bookCache.set(e,{book:o,timestamp:Date.now()}),this.savePersistentCaches(),o}),h((r,o)=>(this.performanceService.markEnd("book-details"),r.status===0||r.status===503?o.pipe():this.handleError(r,"Book not found")))))}invalidateCaches(){this.bookCache.clear(),this.searchCache.clear(),this.savePersistentCaches()}getPopularBooks(e=this.defaultMaxResults){let t={query:"bestseller",maxResults:e,orderBy:"newest"};return this.searchBooks(t)}getSuggestions(e){return e.length<2?[]:["javascript programming","javascript tutorial","java programming","java spring boot","python programming","python data science","angular development","angular tutorial","react development","node.js programming","web development","mobile development","machine learning","artificial intelligence","data structures","algorithms","software engineering","clean code","design patterns","computer science"].filter(r=>r.toLowerCase().includes(e.toLowerCase()))}buildSearchParams(e){let t=new E,r=this.buildQueryString(e.query,e.searchType);return t=t.set("q",r),t=t.set("maxResults",(e.maxResults||this.defaultMaxResults).toString()),e.startIndex&&(t=t.set("startIndex",e.startIndex.toString())),e.langRestrict&&(t=t.set("langRestrict",e.langRestrict)),e.filter&&(t=t.set("filter",e.filter)),e.orderBy&&(t=t.set("orderBy",e.orderBy)),t}buildQueryString(e,t){if(!t||t==="general")return e;switch(t){case"title":return`intitle:${e}`;case"author":return`inauthor:${e}`;case"isbn":return`isbn:${e}`;case"subject":return`subject:${e}`;default:return e}}transformGoogleBooksResponse(e,t){let r=e.items?e.items.map(T=>this.transformVolumeItem(T)):[],o=t.maxResults||this.defaultMaxResults,i=t.startIndex||0,n=Math.floor(i/o)+1;return{query:t.query,totalItems:e.totalItems,currentPage:n,itemsPerPage:o,books:r,hasMoreResults:i+o<e.totalItems,searchTimestamp:new Date,appliedFilters:{searchType:t.searchType,filter:t.filter,langRestrict:t.langRestrict,orderBy:t.orderBy}}}transformVolumeItem(e){let t=e.volumeInfo;return{id:e.id,title:t.title,authors:t.authors,subtitle:t.subtitle,description:t.description,publishedDate:t.publishedDate,pageCount:t.pageCount,language:t.language,categories:t.categories,averageRating:t.averageRating,ratingsCount:t.ratingsCount,imageLinks:t.imageLinks?{smallThumbnail:t.imageLinks.smallThumbnail,thumbnail:t.imageLinks.thumbnail,small:t.imageLinks.small,medium:t.imageLinks.medium,large:t.imageLinks.large,extraLarge:t.imageLinks.extraLarge}:void 0,industryIdentifiers:t.industryIdentifiers?.map(r=>({type:r.type,identifier:r.identifier})),publisher:t.publisher,printType:t.printType,maturityRating:t.maturityRating,webReaderLink:t.previewLink,saleInfo:e.saleInfo?{country:e.saleInfo.country,saleability:e.saleInfo.saleability,retailPrice:e.saleInfo.retailPrice,buyLink:e.saleInfo.buyLink}:void 0}}handleError(e,t){let r=`${t}: `,o=!0;return e.error instanceof ErrorEvent?r+=e.error.message:(r+=`Error Code: ${e.status}
Message: ${e.message}`,e.status===503&&(o=!1,r="Google Books API temporarily unavailable"),e.status===0&&(r="Network error: Please check your internet connection.")),o&&console.error(r),B(()=>new Error(r))}loadPersistentCaches(){try{let e=localStorage.getItem(this.SEARCH_CACHE_STORAGE_KEY);if(e){let r=JSON.parse(e);Object.entries(r).forEach(([o,i])=>{this.searchCache.set(o,i)})}let t=localStorage.getItem(this.BOOK_CACHE_STORAGE_KEY);if(t){let r=JSON.parse(t);Object.entries(r).forEach(([o,i])=>{this.bookCache.set(o,i)})}}catch{}}savePersistentCaches(){try{localStorage.setItem(this.SEARCH_CACHE_STORAGE_KEY,JSON.stringify(Object.fromEntries(this.searchCache))),localStorage.setItem(this.BOOK_CACHE_STORAGE_KEY,JSON.stringify(Object.fromEntries(this.bookCache)))}catch{}}static \u0275fac=function(t){return new(t||a)(p(C),p(R))};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{A as a,j as b,I as c,O as d};
